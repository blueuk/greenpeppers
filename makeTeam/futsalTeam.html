<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Futsal Instant v3.5 (Auto Load)</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f2fe; --secondary: #4facfe; --bg-dark: #0f111a;
            --card-bg: #1e2130; --text-main: #ffffff; --text-dim: #a0aec0;
            --pos-gol: #f6ad55; --pos-ala: #4fd1c5; --pos-fix: #f687b3; --pos-piv: #63b3ed;
            --hover-bg: #3d455d;
        }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg-dark); color: var(--text-main); margin: 0; padding: 10px; }
        .container { width: 100%; max-width: 900px; margin: 0 auto; }
        
        .header-panel { background: var(--card-bg); padding: 15px; border-radius: 20px; margin-bottom: 15px; border: 1px solid #333; }
        .config-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 10px; }
        .input-group { display: flex; flex-direction: column; gap: 4px; }
        .input-label { font-size: 0.7rem; color: var(--text-dim); padding-left: 4px; }
        
        select, input[type="number"] { 
            background: #0b0d14; border: 1px solid #444; color: white; padding: 10px; border-radius: 10px; 
            width: 100%; box-sizing: border-box; outline: none; font-size: 0.85rem; 
        }

        .drop-zone { 
            background: rgba(255,255,255,0.02); border: 2px dashed #444; border-radius: 15px; padding: 12px; 
            min-height: 120px; display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 10px; 
        }

        .player-item { 
            background: #2d3446; padding: 12px 6px; border-radius: 12px; text-align: center; 
            font-size: 0.85rem; border: 1px solid #3d455d; cursor: pointer;
            transition: all 0.2s ease; user-select: none;
        }
        .player-item:hover { 
            background: var(--hover-bg); transform: translateY(-3px); 
            border-color: var(--secondary); box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .player-item:active { transform: scale(0.95); }

        .btn-generate { 
            background: linear-gradient(45deg, var(--secondary), var(--primary)); 
            border: none; padding: 16px; border-radius: 14px; font-weight: 800; cursor: pointer; 
            width: 100%; margin-top: 15px; color: #000; font-size: 1rem; transition: 0.2s;
        }
        .btn-generate:hover { opacity: 0.9; transform: translateY(-2px); }

        .result-grid { margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .team-card { background: var(--card-bg); border-radius: 20px; padding: 15px; border-top: 4px solid var(--secondary); }
        .member-row { 
            display: flex; justify-content: space-between; align-items: center; 
            background: rgba(255,255,255,0.03); padding: 8px 10px; border-radius: 10px; 
            margin-top: 8px; border: 1px solid #333; font-size: 0.85rem; 
        }
        .pos-badge { font-size: 0.65rem; padding: 3px 6px; border-radius: 5px; font-weight: 800; color: #000; }
        #statusMsg { font-size: 0.75rem; text-align: center; color: var(--primary); margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-panel">
        <div style="text-align: center; font-weight: 800; color: var(--primary); margin-bottom: 10px;">FUTSAL TEAM GENERATOR PRO</div>
        <div id="statusMsg">ë°ì´í„° ë¡œë”© ì¤‘...</div>
        <div class="config-row">
            <div class="input-group">
                <span class="input-label">ë§¤ì¹˜ ëª¨ë“œ</span>
                <select id="matchMode"><option value="5">5 vs 5</option><option value="6" selected>6 vs 6</option></select>
            </div>
            <div class="input-group">
                <span class="input-label">íŒ€ ìˆ˜</span>
                <input type="number" id="teamCount" value="2" min="2">
            </div>
            <div class="input-group">
                <span class="input-label">ìš©ë³‘ ì¸ì›</span>
                <input type="number" id="mercCount" value="0" min="0">
            </div>
        </div>
    </div>

    <div style="font-size: 0.8rem; color: var(--secondary); margin: 10px 0 5px; font-weight: 600;">ğŸ‘¥ ëŒ€ê¸° ëª…ë‹¨ (<span id="pCount">0</span>)</div>
    <div id="poolZone" class="drop-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>

    <div style="display: flex; justify-content: space-between; align-items: center; margin: 15px 0 5px;">
        <div style="font-size: 0.8rem; color: var(--primary); font-weight: 600;">âœ… í™•ì • ëª…ë‹¨ (<span id="aCount">0</span>)</div>
        <button onclick="resetList()" style="background:none; border:none; color:#666; cursor:pointer; font-size:0.7rem;">ì „ì²´ ì´ˆê¸°í™” ğŸ”„</button>
    </div>
    <div id="activeZone" class="drop-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>

    <button class="btn-generate" onclick="generateInstant()">íŒ€ ìƒì„± ì‹œì‘</button>
    <button id="copyBtn" onclick="copy()" style="display:none; width:100%; margin-top:10px; padding:15px; background:#28a745; border:none; border-radius:12px; color:white; font-weight:600; cursor:pointer;">ì¹´í†¡ ëª…ë‹¨ ë³µì‚¬ ğŸ“‹</button>
    
    <div id="resultArea" class="result-grid"></div>
</div>

<script>
    let players = [];
    let currentTeams = [];

    const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);

    // ğŸ’¡ GitHub URLì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    async function loadData() {
        const url = 'https://blueuk.github.io/greenpeppers/makeTeam/players.txt';
        const msg = document.getElementById('statusMsg');
        
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            const text = await response.text();
            
            players = text.trim().split('\n').filter(l => l.includes('|')).map((l, i) => {
                const [n, g, a, f, p] = l.split('|');
                return { 
                    id: 'p'+i, 
                    name: n.trim(), 
                    gol: parseFloat(g), 
                    ala: parseFloat(a), 
                    fix: parseFloat(f), 
                    piv: parseFloat(p), 
                    avg: (parseFloat(g)+parseFloat(a)+parseFloat(f)+parseFloat(p))/4, 
                    status: 'pool' 
                };
            });
            
            msg.innerText = "ë°ì´í„° ë¡œë“œ ì™„ë£Œ (" + players.length + "ëª…)";
            render();
        } catch (err) {
            msg.innerText = "ë¡œë“œ ì‹¤íŒ¨: " + err.message;
            msg.style.color = "#ff007b";
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    window.onload = loadData;

    function toggleStatus(id) {
        const p = players.find(x => x.id === id);
        if (p) {
            p.status = (p.status === 'pool') ? 'active' : 'pool';
            render();
        }
    }

    function allowDrop(e) { e.preventDefault(); }
    function drag(e) { e.dataTransfer.setData("text", e.target.id); }
    function drop(e) {
        e.preventDefault();
        const id = e.dataTransfer.getData("text");
        const p = players.find(x => x.id === id);
        if (p) { p.status = e.currentTarget.id === 'activeZone' ? 'active' : 'pool'; render(); }
    }

    function render() {
        const pz = document.getElementById('poolZone'), az = document.getElementById('activeZone');
        pz.innerHTML = az.innerHTML = "";
        let ac = 0, pc = 0;
        
        [...players].sort((a,b)=>a.name.localeCompare(b.name, 'ko')).forEach(p => {
            const d = document.createElement('div');
            d.className = 'player-item';
            d.id = p.id;
            d.draggable = true;
            d.ondragstart = drag;
            d.onclick = () => toggleStatus(p.id);
            d.innerHTML = `<b>${p.name}</b>`;
            
            if (p.status === 'active') { az.appendChild(d); ac++; } 
            else { pz.appendChild(d); pc++; }
        });
        document.getElementById('aCount').innerText = ac; 
        document.getElementById('pCount').innerText = pc;
    }

    function resetList() { players.forEach(p => p.status = 'pool'); render(); document.getElementById('resultArea').innerHTML = ""; }

    function generateInstant() {
        const teamCnt = +document.getElementById('teamCount').value;
        const mercCnt = +document.getElementById('mercCount').value;
        const mode = +document.getElementById('matchMode').value;
        let activePool = players.filter(p => p.status === 'active').map(p => ({...p, assigned: false}));
        
        if (mercCnt > 0) {
            const avgVal = activePool.length > 0 ? activePool.reduce((a,c)=>a+c.avg,0) / activePool.length : 80.0;
            for(let i=1; i<=mercCnt; i++) {
                activePool.push({ id: 'm'+i, name: 'ìš©ë³‘'+i, gol: avgVal, ala: avgVal, fix: avgVal, piv: avgVal, avg: avgVal, assigned: false, isMercenary: true });
            }
        }

        if (activePool.length < teamCnt) return alert("ì¸ì›ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");

        let teams = Array.from({length: teamCnt}, (_, i) => ({ id: i+1, members: [], totalScore: 0 }));
        const getWeakest = () => [...teams].sort((a,b) => a.totalScore - b.totalScore || a.members.length - b.members.length)[0];

        // íŠ¹ì • ì„ ìˆ˜ ë¡œì§ (í•„ìš” ì‹œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥)
        const ds = activePool.find(x => x.name === "ê¹€ë™ì„­"), jh = activePool.find(x => x.name === "ì„ì •í˜„");
        if(ds && jh && teamCnt >= 2) {
            ds.assigned = jh.assigned = true;
            teams[0].members.push(ds); teams[0].totalScore += ds.avg;
            teams[1].members.push(jh); teams[1].totalScore += jh.avg;
        }

        const steps = [{key:'fix',cnt:teamCnt*2},{key:'ala',cnt:teamCnt*(mode==6?2:1)},{key:'piv',cnt:teamCnt}];
        steps.forEach(s => {
            let cans = activePool.filter(p => !p.assigned).sort((a,b) => b[s.key] - a[s.key]).slice(0, s.cnt);
            shuffle(cans).forEach(p => { let t = getWeakest(); p.assigned = true; t.members.push(p); t.totalScore += p.avg; });
        });

        activePool.filter(p => !p.assigned).sort((a,b) => b.avg - a.avg).forEach(p => {
            let t = getWeakest(); p.assigned = true; t.members.push(p); t.totalScore += p.avg;
        });

        currentTeams = teams;
        display();
    }

    function display() {
        const area = document.getElementById('resultArea'); area.innerHTML = "";
        currentTeams.forEach(t => {
            const card = document.createElement('div'); card.className = 'team-card';
            const mHtml = t.members.map(m => {
                const b = [{n:'GOL',v:m.gol,c:'f6ad55'},{n:'ALA',v:m.ala,c:'4fd1c5'},{n:'FIX',v:m.fix,c:'f687b3'},{n:'PIV',v:m.piv,c:'63b3ed'}].sort((a,b)=>b.v-a.v)[0];
                return `<div class="member-row"><span style="${m.isMercenary?'color:var(--primary)':''}">${m.name}</span><span class="pos-badge" style="background:#${b.c}">${b.n} ${b.v.toFixed(1)}</span></div>`;
            }).join('');
            card.innerHTML = `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #444; padding-bottom:8px;"><strong>TEAM ${t.id}</strong><small>í‰ê· : ${(t.totalScore/t.members.length).toFixed(1)}</small></div>${mHtml}`;
            area.appendChild(card);
        });
        document.getElementById('copyBtn').style.display = 'block';
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function copy() {
        const txt = currentTeams.map(t => `[${t.id}íŒ€] ${t.members.map(m => m.name).join(', ')}`).join('\n');
        navigator.clipboard.writeText(txt).then(() => alert("ëª…ë‹¨ ë³µì‚¬ ì™„ë£Œ!"));
    }
</script>
</body>
</html>
