<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futsal Scout - Radar Compare PRO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f2fe; --secondary: #4facfe; --bg-dark: #0f111a;
            --card-bg: #1e2130; --text-main: #ffffff; --accent: #ff007b;
        }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg-dark); color: var(--text-main); margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        header { text-align: center; margin-bottom: 30px; }
        .control-panel { background: var(--card-bg); padding: 20px; border-radius: 20px; border: 1px solid #333; margin-bottom: 30px; }
        
        /* 비교 섹션 */
        .compare-section { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 40px; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 20px; border: 1px solid var(--secondary); display: none; }
        .compare-selectors { display: flex; flex-direction: column; gap: 10px; justify-content: center; }
        select { background: #0b0d14; color: white; border: 1px solid #444; padding: 12px; border-radius: 10px; font-size: 1rem; }

        .player-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .player-card { background: var(--card-bg); border-radius: 20px; padding: 15px; border: 1px solid #333; }
        .player-name { font-size: 1.2rem; font-weight: 800; text-align: center; margin-bottom: 10px; color: var(--primary); }
        
        .badge-vs { background: var(--accent); color: white; padding: 2px 8px; border-radius: 5px; font-size: 0.7rem; margin-right: 5px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>SCOUT RADAR & COMPARE</h1>
        <div class="control-panel" style="margin-top:20px;">
            <input type="file" id="jsonInput" accept=".txt">
            <p style="font-size:0.8rem; color:#a0aec0; margin-top:10px;">player.txt를 불러오면 자동으로 이름순 정렬됩니다.</p>
        </div>
    </header>

    <div class="compare-section" id="compareSection">
        <div class="compare-selectors">
            <h3 style="margin:0; color:var(--secondary);">VS COMPARISON</h3>
            <p style="font-size:0.8rem; color:#888;">두 선수를 선택하여 능력치를 대조하세요.</p>
            <select id="selectA" onchange="updateCompare()"></select>
            <div style="text-align:center; font-weight:800; color:var(--accent);">VS</div>
            <select id="selectB" onchange="updateCompare()"></select>
        </div>
        <div style="background:#000; border-radius:15px; padding:10px;">
            <canvas id="compareChart"></canvas>
        </div>
    </div>

    <h2 id="gridTitle" style="display:none; border-left:4px solid var(--primary); padding-left:10px;">전체 명단 (이름순)</h2>
    <div class="player-grid" id="playerGrid"></div>
</div>

<script>
    const radarGroups = {
        "신체": ["몸싸움", "균형감", "체력", "스피드"],
        "정신": ["리더십", "의사소통", "집중력", "대담성", "침착성"],
        "수비": ["일대일수비", "수비지원", "수비위치선정", "대인마크", "가로채기"],
        "공격": ["일대일돌파", "공격위치선정", "슛파워", "슛정확도"],
        "기술": ["연계플레이", "패스", "롱패스", "드리블"],
        "키핑": ["반사신경", "공중볼처리(키퍼)"]
    };

    let allPlayers = [];
    let compareChart = null;

    document.getElementById('jsonInput').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(ev) {
            try {
                const rawText = ev.target.result.trim();
                const jsonArrayText = "[" + rawText.replace(/,\s*$/, "") + "]";
                allPlayers = JSON.parse(jsonArrayText);
                
                // 1. 이름순 정렬 (가나다순)
                allPlayers.sort((a, b) => a.name.localeCompare(b.name, 'ko'));

                initCompareUI();
                renderGrid();
                document.getElementById('compareSection').style.display = 'grid';
                document.getElementById('gridTitle').style.display = 'block';
            } catch(err) { alert("파일 형식이 올바르지 않습니다."); }
        };
        reader.readAsText(e.target.files[0]);
    });

    // 능력치 계산기
    function getRadarData(player) {
        return Object.values(radarGroups).map(stats => {
            const sum = stats.reduce((acc, s) => acc + (player[s] || 10), 0);
            return (((sum / stats.length) / 20) * 100).toFixed(1);
        });
    }

    // 비교 UI 초기화
    function initCompareUI() {
        const selA = document.getElementById('selectA');
        const selB = document.getElementById('selectB');
        selA.innerHTML = ""; selB.innerHTML = "";

        allPlayers.forEach((p, idx) => {
            const opt = `<option value="${idx}">${p.name}</option>`;
            selA.innerHTML += opt;
            selB.innerHTML += opt;
        });
        if(allPlayers.length > 1) selB.selectedIndex = 1;
        updateCompare();
    }

    // 비교 차트 업데이트
    function updateCompare() {
        const p1 = allPlayers[document.getElementById('selectA').value];
        const p2 = allPlayers[document.getElementById('selectB').value];
        const data1 = getRadarData(p1);
        const data2 = getRadarData(p2);

        const ctx = document.getElementById('compareChart').getContext('2d');
        if(compareChart) compareChart.destroy();

        compareChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: Object.keys(radarGroups),
                datasets: [
                    {
                        label: p1.name,
                        data: data1,
                        borderColor: '#00f2fe',
                        backgroundColor: 'rgba(0, 242, 254, 0.2)',
                        pointBackgroundColor: '#00f2fe'
                    },
                    {
                        label: p2.name,
                        data: data2,
                        borderColor: '#ff007b',
                        backgroundColor: 'rgba(255, 0, 123, 0.2)',
                        pointBackgroundColor: '#ff007b'
                    }
                ]
            },
            options: {
                scales: { r: { min: 0, max: 100, ticks: { display: false }, grid: { color: '#333' }, pointLabels: { color: '#fff' } } },
                plugins: { legend: { labels: { color: '#fff', font: { size: 14, weight: 'bold' } } } }
            }
        });
    }

    // 하단 그리드 렌더링
    function renderGrid() {
        const grid = document.getElementById('playerGrid');
        grid.innerHTML = "";
        allPlayers.forEach((player, idx) => {
            const data = getRadarData(player);
            const card = document.createElement('div');
            card.className = 'player-card';
            card.innerHTML = `
                <div class="player-name">${player.name}</div>
                <canvas id="grid-chart-${idx}"></canvas>
            `;
            grid.appendChild(card);
            
            new Chart(document.getElementById(`grid-chart-${idx}`), {
                type: 'radar',
                data: {
                    labels: Object.keys(radarGroups),
                    datasets: [{ data: data, borderColor: '#4facfe', backgroundColor: 'rgba(79, 172, 254, 0.1)', pointRadius: 0 }]
                },
                options: {
                    scales: { r: { min: 0, max: 100, ticks: { display: false }, pointLabels: { display: false } } },
                    plugins: { legend: { display: false } }
                }
            });
        });
    }
</script>
</body>
</html>